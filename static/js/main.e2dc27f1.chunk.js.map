{"version":3,"sources":["react_scatter_board/texture.js","react_scatter_board/utils.js","react_scatter_board/ScatterData.js","react_scatter_board/ScatterPlot.jsx","react_scatter_board/ScatterWidgets.jsx","react_scatter_board/ScatterBoard.jsx","react_scatter_board/Lazy.jsx","utils.js","App.js","reportWebVitals.js","index.js"],"names":["imageData","circle","cross","diamond","square","Texture","symbolType","this","image","Image","src","texture","THREE","needsUpdate","symbolTypes","Object","keys","RARE","getDataType","value","type","Number","isInteger","orderArray","arr","indices","orderedArr","Array","length","i","encodeRareCategories","k","counts","_","countBy","sortBy","pairs","tuple","frequentCategories","map","slice","indexOf","binValues","nbins","extent","d3","min","parseFloat","max","interval","domain","range","labels","toFixed","label","push","binValues2","ScatterDataSubset","data","n","getIndicesAndPositions","positions","Uint32Array","Float32Array","x","y","z","metaKey","record","ScatterData","metas","parse","xyz","key","values","o","nUnique","Set","utils","name","index","labelKeys","labelKey","dataSubsets","groupBy","mapObject","records","list","binnedValues","pluck","obj","Math","floor","filter","edge","rec","colorOptions","meta","shapeOptions","allLabels","getAttr","options","findWhere","dtype","uniqueCats","nUniqueCats","size","from","idx","greyIdx","elem","greyIdx2","colorExtent","minScore","maxScore","colorScale","d3Scale","shapeLabels","symbols","t","scatterDataSubsets","shapeScale","binBy","pValueDomain","binBy2","PointsGeometry","args","model","geometry","createGeometry","setIndex","setAttribute","userData","computeBoundingSphere","Scatter3dView","props","is3d","state","isLoading","isLoaded","url","colorKey","shapeKey","pointSize","onMouseMove","bind","onMouseDown","onMouseUp","onClick","setState","fetch","then","response","ok","json","Error","makeMaterial","setUpStage","shapeBy","prevProps","prevState","snapshot","startAnimate","animateId","stopAnimate","ref","mount","style","aspectRatio","width","height","scene","id","uuid","renderer","setClearColor","left","right","ORTHO_CAMERA_FRUSTUM_HALF_EXTENT","bottom","top","camera","position","domElement","display","appendChild","controls","OrbitControls","enableZoom","enableDamping","dampingFactor","screenSpacePanning","autoRotate","autoRotateSpeed","enableRotate","mouseButtons","LEFT","RIGHT","MIDDLE","DOLLY","addEventListener","mouse","updated","e","mouseMoved","undefined","nativeEvent","assign","offsetX","offsetY","trueIdx","points","getPoint","datum","materials","textureResult","load","material","vertexColors","sizeAttenuation","alphaTest","transparent","opacity","children","child","remove","calculateShapeScale","geometries","mergedGeometry","BufferGeometryUtils","mergeBufferGeometries","g","reduce","arr1","arr2","concat","getLabels","groupSizes","count","cumsums","a","unshift","addGroup","clearScene","add","setColors","closestPoint","resetColors","textLabel","document","getElementById","attributes","color","array","pointPosition","textCanvas","makeTextCanvas","rotation","fontsize","fontface","textColor","r","b","onMouseOver","message","euler","parameters","hasOwnProperty","lineHeight","canvas","createElement","context","getContext","font","textBaseline","textAlign","fillStyle","point","applyEuler","pv","copy","project","coords","lines","split","fillText","pointerEvents","colors","toArray","animate","clientWidth","clientHeight","window","devicePixelRatio","needResize","setSize","resizeRendererToDisplaySize","aspect","updateProjectionMatrix","update","renderScatter","render","requestAnimationFrame","cancelAnimationFrame","query","removeHighlightedPoints","matchedData","dataSubset","highlightCould","createHighlightCloud","geometryHighlight","highlightPoints","getObjectByName","closestDist","point3","point2","pointIndex","set","dist","distanceToSquared","zoom","React","Component","Legend","setUpDOMs","displayColorLegend","displayShapeLegend","el","append","attr","zIndex","overflow","legendShape","legend","legendSymbol","scale","orient","title","select","call","legendColor","shapeWidth","cells","labelFormat","SelectDropdown","defaultValue","handleChange","onChange","styles","container","onSelectChange","SearchSelectize","searchStr","searched","handleClear","defaultInputValue","placeholder","className","marginTop","onInputChange","onClearBtnClicked","ScatterBoard","searchKeys","handleColorKeyChange","handleShapeKeyChange","handleSearchInputChange","handleClearBtnClick","calculateColorScale","searchOptions","getColorOptions","getShapeOptions","getSearchOptions","scatter3dView","valueObj","highlightQuery","get_dtype","v","read_tsv","text","rows","line","replace","header","shift","row_0","row","rowdict","DirectionRenderer","App","useState","plotData","setPlotData","tableData","setTableData","selectedCluster","setSelectedCluster","gridApi","setGridApi","setGridColumnApi","useEffect","_data","sid","pid","cluster","visit","textDecoration","fontSize","href","evt","setFilterModel","getFilterModel","filterType","margin","onGridReady","params","api","columnApi","autoSizeAllColumns","adjusted_pvalue","applyColumnState","colId","sort","defaultState","rowData","h","ind","field","sortable","cellStyle","resizable","valueFormatter","toPrecision","cellRenderer","comparator","valueA","valueB","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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,IAAMgF,EAAMJ,EAAW/D,QAAQqC,GAC3BiC,EAAW,IACwB,IAAnCP,EAAW/D,QAAQ,aACrBsE,EAAW,IAEb,IAAMD,EAAON,EAAWO,GACxBP,EAAWO,GAAYjC,EACvB0B,EAAWI,GAAOE,EAKtB,IAAIE,EAAcnE,IAAUyB,GACtB2C,EAAWD,EAAY,GACvBE,EAAWF,EAAY,GACzBG,EAAaC,MAEdlE,OAAO,CAAC+D,GAAWA,EAAWC,GAAY,EAAGA,IAC7C/D,MAAM,CAAC,UAAW,OAAQ,YAE7B,GAAc,YAAVoD,EACFY,EAAaC,MAEVlE,OAAO,EAAC,GAAM,IACdC,MAAM,CAAC,UAAW,iBAChB,GAAIsD,EAAc,GACvBU,EAAaC,IAAqBvE,KAAqBK,OAAOsD,QACzD,GAAIC,EAAc,IAAMA,GAAe,GAC5CU,EAAaC,IAAqBvE,KAAqBK,OAAOsD,QACzD,GAAIC,GAAe,GAAI,CAsH5BU,EAAaC,MAEVjE,MAvHc,CACf,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YAKCD,OAAOsD,GAGZ,OAAOW,IAnUX,0CAsUsBhD,GAClB,IAQIkD,EARAC,EAAUzE,IAAWN,KAAI,SAAAgF,GAAC,OAAI1E,MA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","file":"static/js/main.e2dc27f1.chunk.js","sourcesContent":["import * as THREE from 'three'\n\n// generated according to https://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript\nconst imageData = {\n  circle:\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACtElEQVRYR+2Wz2sTQRTH5+2mNu2QbJY1Ymuym9nkInjwR/HgQRQVEf8Db9KDB0+K+CfovT0IIuKf4EVBUfSioGD1KJjdndmEEJrY1mQDadjdkZFWSkmT3aQShO5133vfz7z9znsLaMIPTFgfHQD8nx2wLOs6ABQ45/qWhxhCiBWLxRdxPRW5A/V6HXe73UdhGN7AGNclSTqWSCT+6Pm+j8IwrHqedxQAnhFCbgNALwpMJADbts8DwHNVVdV0Oo0A+qdxzlGr1ULr6+utIAiulUqlj8MghgLUarUF3/ff5vP59LBiO99Xq9W2LMsX5ufnVwblDQQol8snpqamPui6Hkt8W5Ax1uacnyWEfN8LYiAApbSZy+U0WZbjHP5vbBAEyHXdhmmaR2IDUErvzs7OPshms9MjqW8lNRqNzU6nc58QstSvzp4dYIx91TTtJMZ4HH3U6XTQ2traF13XF2IBWJYVEkJgL8dHpRI3g1IamqbZ9zv27YBt21eSyeTrubm5qDoD42q1Gur1ehcJIe93B/YFoJQ+yWQyi4qi7AvAxsaGmA+PDcO4FRlAUZTFTCYzGQDLsi7NzMy8mdgnEMfeLxOGYYgYY/FMKAAYYyuapp2a2DV0HOcOxvjhuINodXW11+127xmGsRxrDohgx3Ga+Xx+5FEs1nSlUmmappmNPYpFAqX0OELok2EYqVGug+u6nu/7p4vF4o+RALa8cAYh9E7X9VgQruv+Eus4l8t9G3kdbyeWy+Vzsiy/VFVVSaVSSJKkvjWF49vttpj9bYTQZdM0Pw/r3NAfku0CnPNDtm0vAcBNjHETAIQ3psWu8H1/k3P+0/O8w5IkPS0UCuKXLBwmLt5HBthZzHGcq0EQFADA4JwLIVeWZUYIeRVFdGfMSABxRcb2wH4KRlpG/1LwAGB3B34DBWQWMG24djEAAAAASUVORK5CYII=',\n  cross:\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA50lEQVRYR+2XPQ6DMAyF8QZbfIYchN4spRer6D1yBcyWbKmylZI4WB0oklmdn8cnvfcAupMfOPn+7noCvPeOo2atnSRURQTy5cMwuL7vi/tijCmE8LDW3o+KEAtARIeIxX1ElIhIBSiBixNo+HxExBvngmVZXgDwrNnwOyc2dmr5PB+KiKzFiag6L+XETgDn86PhUltXygkVoAT+jwBXt7/aMITQxRinz7re1ar3vtrlADAaY3IYVet4Xdc5pTQzQbQ5X78HlIASEBPgcqLk81aDigTkw7icyHPJP0FeLxbQeiPpXAW8AUg5MTAvQNb8AAAAAElFTkSuQmCC',\n  diamond:\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACaElEQVRYR9WXy4vTUBTG05DW2E7sI6XPlOTeUkTcqeB2QHApIrgTXIr+AbrVlW5cKbidlStFXKsrl+IsB4T23tiGtolp2pLbTh9JkQwpjNppmkyHYFaB3POdX777OidCBXwQQhdpmv5GUdRisVhchxD+CCIVCRLkxGCMv+fz+SvOu6qq+wCAq0G0AgHU6/Xb8Xh8r1gsJp2knU5nOJ1O7wMAPvqFCASAMTYEQUgzDHOUz7IsqtVq9SGEmTMHwBg/5TjuCc/z7PFkvV5vYprmCwDAMz8QvhzQNG2HEKIDAM6tSoIxnrEsmy6VSuNNIXwBYIzf8zx/h+O4lfqmaVKGYbyTJOnu1gEajca1aDT6pVKpXFgnriiKadv2riRJ+5tAbOwAxvigUChcYtk/pv6fHJPJhOp2uwcAgMtbA0AI3UskEm9yudzOJqKqqpLRaPSgWq2+9Rq/kQMIoUNRFFmapr30jr7btk01m80xhDDhFeAJgBB6mUqlHqbT6fNeYse/9/v9w8Fg8BpC+Hhd3FoAjHEhEok0RFGM+0m+HCvL8tiyLKlWq/06KX4tgCzLn7PZ7I1EwtPJlfqEEErX9U8AgJu+ATDGuwzDfBAEIRXk75cxiqIM5vP5LQjh11U6JzqAEGqWy+VKLBY7TX5qNptR7Xb7JwBA+r8AQp8Cx65QF6EDEPo2dCCcgyiZTD7KZDLrL4G/VphhGJPhcPjqVAfRUjPUo9h1wddlpGkaIYRs7zJy10N417EDEHpB4roQXknmAIRelLourCzLdV2fEkKen2lZvtyWoTYmDkTorZk7FeE1p+7htJX2/DfV7WYwLPkGlAAAAABJRU5ErkJggg==',\n  square:\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAp0lEQVRYR+2WMQ4CIRBFWQoyFQ03YG7naqPHsNEY9XLADSjooFrD1mJixmRj8qlh/ssbij+pjc+0cb4CAAx8NBBCOGitjfCjVu/9fTRjCNDDiehKRKI1tdaWWuuemR/vIIbDU0ona+3ZOScCyDkvpZQjM18AAAMwAAMwAAMw8HcGZmPM7UeFZGbm51cG+uUY404pJa1kbRTeM0RtR9gV1+cAgIHNDbwAdNviIRMkcw0AAAAASUVORK5CYII=',\n  'triangle-down':\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC2klEQVRYR+2WPWzTQBiGnR/iFrs4pFadpolyn09VJZAYOjDQCYmFiYVKIDHQgRWxMCAhIaSuHWCEAXWknZAQG1IHJAbEAggGcpc4bVK3Sdu0SUwSXBu5clHTpk7sJC0D3uLcfe9z730/9jGn/PhOWZ/5dwAURblgGEbiJBzx+XxZhNAPS+uvA5RSJRQK8f0GME3Tp+v6NgBAEwAh5DbHcS8lSeL6CbG2tlbVNG1GluXFJgDrRyaT+SZJ0sWBgYG+MNRqNUZV1a8AcGlfoCkJM5nMZCAQWIrH40P9IFheXq7ouj4ly/KXlgC2C4uRSOTm0FBvGXZ2dpjNzc3XAHDr4OGOlGE+nz9bq9W2ACDUSxcopbphGPz4+HjdEcD6M51OP+F5/pEoimwvIIrFYr1cLs/Ksjx7ON6xjSidTm/E4/FIMBjsikHXdWZlZWUDAMRWgZwAbrAsOz86Oip0Q6Cq6ramaXcwxm9dAdhX8VmSpMnBwUFPDJqmMcVi8VMymbx8XADHWUApnfD7/VYATyWRzWatspvEGP/0BGBtUhRlXhCEaUEQXNlQKpV+lUqlBQC462RfR9OQEGLKsuzqGiilDMa4bfy2C+zm9JDjuMeiKJ7rhKJQKJQ1TXuKEJprt74jADshV2OxWDQUcu5PjUaDyefzqwAQayd+ZBg5bSCEXGNZdmFsbOy807pcLrdVr9enMcbvewpgJ+SH4eHhKY5rPbGr1SpTKBSWAOBqJ+KuHLAWp1KpRDAY/J5MJlt+uCiKUg0EAhOJRCLXFwA7F56Fw+F74XC4qSztsnsBAA86FXftwH5gQkgDIXTG7/fvvTIMw/qY+Y0xdj1BO66Cg6cihMzwPP98ZGRk7yrW19crlUrlPsb4lZvTe3bA7g0kGo3udSdVVSlCCLsV7woglUpdYVn2nRVkd3f3OkLo44kC2GX5xjRNKx+mvYh35YBXwcP7PCVhr8T/O2A58AfGZw8wtSahoQAAAABJRU5ErkJggg==',\n  'triangle-up':\n    ',iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC3UlEQVRYR+2VP2gTURzHLyG5tOnFXD0uJsTj3u9dB4s4iIIOIk5uDnUQQdChuApOBScFh4KDg4uDOgkKKoKO4iAI4lIciiD03rtoSnOJTbzcJTmS651EraTm312a2qVvvd/v+/2873vvdyFml1dol/2ZPYBtJUApfdk+QgCYG/UoRwZQVfVULBZ77Xke02w2zymK8n4UiJEBKKU0k8mgtmmhUKAIIfzfAAgh8xzH3RVFMdE2LRaLZq1Wu44xfhgUYqQEVFVtAUAkFPrd7rouo2maoyhKdMcBCCH3eJ6fn56enuw0q1QqjWq1+gAhdC0IRKAECCFyOBxelmWZ62WSy+WsjY2Nw4qifPULEQhA07QPoiiejMfjPfVrtRpTKpXeAcCZsQMQQs6yLPskm83uHyS+urpabjabFzHGb/xA+E6AUlrIZrMHotHB96zVajH5fF7HGKfHBkApXZiamrohiuI+P6KlUqlar9dvI4TuDKsfmoDneWFCSAtjHB4m1vmdEOIpijK0ZyiApmmPeZ6fSyaTvW9eHyrDMOqGYTyXZfnKIPCBAJqmzTIM81GW5V8TL+jK5XKG67onMMZf+vUOA1hKpVJHJye3zBzfHI1Gg9F1fQkAjgUGWFlZmYvH448ymQzv27FH4drammHb9mWM8ateOn0TIIRUJEniI5HIdvwZx3Haz7IMAIJvAErpzUQisSAIwsS23P80r6+v26ZpLgLArX/1uhIoFoucZVnfASA2DvNNjfZTZlk2KUlSo1O3C4BS+kIQhPOJxEgXvy+zaZpMuVx+hhC60BdAVdXj0Wj0rSRJviZe0ITy+bzpOM5pAPi02bslAUrp53Q6PTsxMZaj7+Kzbbv9LJcRQke6AFRVvcRx3P1UKtXzXx90t/3qdV23LMu6OjMz87Rd8zcBQojGsuyORN8J43leyHGcHwAAWwAopYdc1z04rp0OnP+h0LfN8Tz0Z7TTQHsAPwHv3BIw9zTkUQAAAABJRU5ErkJggg=='\n}\n\nexport class Texture {\n  constructor(symbolType) {\n    this.symbolType = symbolType\n  }\n\n  load() {\n    // Load a texture synchronously\n    let image = new Image()\n    image.src = 'data:image/png;base64' + imageData[this.symbolType]\n    let texture = new THREE.Texture(image)\n    texture.needsUpdate = true\n    return texture\n  }\n}\nexport const symbolTypes = Object.keys(imageData)\n\n","import _ from 'underscore'\nimport * as d3 from 'd3'\n/*\n * Utility functions\n */\n\nexport function getCanvasColor(color) {\n  return 'rgba(' + color.r + ',' + color.g + ',' + color.b + ',' + color.a + ')'\n}\n\nexport const RARE = 'other'\n\nexport function getDataType(value) {\n  let type = typeof value\n  if (type === 'number') {\n    type = 'int'\n    if (!Number.isInteger(value)) {\n      type = 'float'\n    }\n  }\n  return type\n}\n\nexport function orderArray(arr, indices) {\n  // Reorder arr based on indices\n  const orderedArr = new Array(arr.length)\n  for (let i = 0; i < arr.length; i++) {\n    orderedArr[i] = arr[indices[i]]\n  }\n  return orderedArr\n}\n\nexport function encodeRareCategories(arr, k) {\n  // Count occurrences of each unique categories in arr,\n  // then keep top k and encode rare categories as 'rares'\n  let counts = _.countBy(arr)\n  // sort values\n  counts = _.sortBy(_.pairs(counts), tuple => -tuple[1])\n  // get top k frequent categories\n  const frequentCategories = _.map(counts.slice(0, k), tuple => tuple[0])\n  for (let i = 0; i < arr.length; i++) {\n    if (frequentCategories.indexOf(arr[i]) === -1) {\n      arr[i] = RARE\n    }\n  }\n  return arr\n}\n\nexport function binValues(arr, nbins) {\n  // Binning continues array of values in to nbins\n  let extent = d3.extent(arr)\n  let min = parseFloat(extent[0])\n  let max = parseFloat(extent[1])\n  let interval = (max - min) / nbins // bin width\n\n  let domain = _.range(1, nbins).map(function(i) {\n    return i * interval + min\n  }) // bin edges\n  let labels = [min.toFixed(2) + ' to ' + domain[0].toFixed(2)]\n\n  for (let i = 0; i < nbins - 1; i++) {\n    let label\n    if (i === nbins - 2) {\n      // the last bin\n      label = domain[i].toFixed(2) + ' to ' + max.toFixed(2)\n    } else {\n      label = domain[i].toFixed(2) + ' to ' + domain[i + 1].toFixed(2)\n    }\n    labels.push(label)\n  }\n  return {\n    labels: labels,\n    domain: domain,\n    min: min,\n    max: max,\n    interval: interval\n  }\n}\n\nexport function binValues2(arr, domain) {\n  // Binning continues array of values by a given binEdges (domain)\n  // domain: [0.001, 0.01, 0.05, 0.1, 1]\n  // domain should include the largest (rightest) value\n  let extent = d3.extent(arr)\n  let min = parseFloat(extent[0])\n  let max = parseFloat(extent[1])\n\n  let labels = ['0 to ' + domain[0]]\n  let nbins = domain.length\n\n  for (let i = 0; i < nbins - 1; i++) {\n    let label = domain[i] + ' to ' + domain[i + 1]\n    labels.push(label)\n  }\n  return { labels: labels, domain: domain.slice(0, -1), min: min, max: max }\n}\n\nexport function binBy(list, key, nbins) {\n  // similar to _.groupBy but applying to continues values using `binValues`\n  // list: an array of objects\n  // key: name of the continues letiable\n  // nbins: number of bins\n  let values = _.pluck(list, key)\n  let binnedValues = binValues(values, nbins)\n  let labels = binnedValues.labels\n  let min = binnedValues.min\n  let interval = binnedValues.interval\n\n  let grouped = _.groupBy(list, function(obj) {\n    let i = Math.floor((obj[key] - min) / interval)\n    if (i === nbins) {\n      // the max value\n      i = nbins - 1\n    }\n    return labels[i]\n  })\n  return grouped\n}\n\nexport function binBy2(list, key, domain) {\n  // wrapper for `binValuesBy`\n  let values = _.pluck(list, key)\n  let binnedValues = binValues2(values, domain)\n  let labels = binnedValues.labels\n\n  let grouped = _.groupBy(list, function(obj) {\n    let i = _.filter(domain, function(edge) {\n      return edge < obj[key]\n    }).length\n    return labels[i]\n  })\n  return grouped\n}\n","import * as d3 from 'd3'\nimport * as d3Scale from 'd3-scale'\nimport _ from 'underscore'\nimport * as utils from './utils'\n\nexport class ScatterDataSubset {\n  // \"model\" for PointsGeometry\n  constructor(data) {\n    this.data = data\n    this.n = data.length\n    const { indices, positions } = this.getIndicesAndPositions(data)\n    this.indices = indices\n    this.positions = positions\n  }\n\n  getIndicesAndPositions(data) {\n    const n = this.n\n    const indices = new Uint32Array(n)\n    const positions = new Float32Array(n * 3)\n    for (let i = 0; i < n; i++) {\n      indices[i] = i\n      positions[(i * 3)] = data[i].x\n      positions[(i * 3) + 1] = data[i].y\n      positions[(i * 3) + 2] = data[i].z || 0\n    }\n    return { indices: indices, positions: positions }\n  }\n\n  getAttr(metaKey) {\n    return this.data.map(record => record[metaKey])\n  }\n}\n\nexport class ScatterData {\n  constructor(data) {\n    this.data = data\n    this.n = data.length\n    this.metas = []\n    this.parse()\n    const { indices, positions } = this.getIndicesAndPositions()\n    this.indices = indices\n    this.positions = positions\n  }\n\n  parse() {\n    // extract the meta data `metas` in the array of object\n    const data = this.data\n    const xyz = ['x', 'y', 'z']\n    for (const key of Object.keys(data[0])) {\n      if (xyz.indexOf(key) === -1) {\n        const values = data.map(o => o[key])\n        const nUnique = [...new Set(values)].length\n        const type = utils.getDataType(data[0][key])\n        this.metas.push({\n          name: key,\n          nUnique: nUnique,\n          type: type\n        })\n      }\n    }\n  }\n\n  getIndicesAndPositions() {\n    const n = this.n\n    const indices = new Uint32Array(n)\n    const positions = new Float32Array(n * 3)\n    for (let i = 0; i < n; i++) {\n      indices[i] = i\n      positions[(i * 3)] = this.data[i].x\n      positions[(i * 3) + 1] = this.data[i].y\n      positions[(i * 3) + 2] = this.data[i].z || 0\n      // add index to the object\n      this.data[i].index = i\n    }\n    return { indices: indices, positions: positions }\n  }\n\n  getLabels(labelKeys) {\n    // return an array of label texts given a list of labelKeys\n    const n = this.n\n    const labels = new Array(n)\n    let i = 0\n    for (const record of this.data) {\n      let label = ''\n      for (const labelKey of labelKeys) {\n        label += labelKey + ': ' + record[labelKey] + ' \\n'\n      }\n      labels[i] = label\n      i++\n    }\n    return labels\n  }\n\n  groupBy(metaKey) {\n    // group by a metaKey and return an object of ScatterDataSubset objects keyed by metaKey\n    const dataSubsets = _.groupBy(this.data, metaKey)\n    const scatterDataSubsets = _.mapObject(dataSubsets, (records, key) => {\n      return new ScatterDataSubset(records)\n    })\n    return scatterDataSubsets\n  }\n\n  binBy(metaKey, nbins) {\n    const dataSubsets = utils.binBy(this.data, metaKey, nbins)\n    const scatterDataSubsets = _.mapObject(dataSubsets, (records, key) => {\n      return new ScatterDataSubset(records)\n    })\n    return scatterDataSubsets\n  }\n\n  binBy2(metaKey, domain) {\n    const dataSubsets = utils.binBy2(this.data, metaKey, domain)\n    const scatterDataSubsets = _.mapObject(dataSubsets, (records, key) => {\n      return new ScatterDataSubset(records)\n    })\n    return scatterDataSubsets\n  }\n\n  getAttr(metaKey) {\n    return this.data.map(record => record[metaKey])\n  }\n\n  setAttr(key, values) {\n    for (let i = 0; i < this.n; i++) {\n      const rec = this.data[i]\n      rec[key] = values[i]\n      this.data[i] = rec\n    }\n    // add meta data of this new attr\n    this.metas.push({\n      name: key,\n      nUnique: [...new Set(values)].length,\n      type: utils.getDataType(values[0])\n    })\n  }\n\n  getColorOptions() {\n    let colorOptions = this.metas.filter(meta => {\n      return meta.nUnique < this.n && meta.nUnique > 1\n    })\n    colorOptions = colorOptions.map(meta => {\n      return { value: meta.name, label: meta.name }\n    })\n    return colorOptions\n  }\n\n  getShapeOptions() {\n    let shapeOptions = this.metas.filter(meta => {\n      return meta.type !== 'float' && (meta.nUnique < 7 && meta.nUnique > 1)\n    })\n    shapeOptions = shapeOptions.map(meta => {\n      return { value: meta.name, label: meta.name }\n    })\n    return shapeOptions\n  }\n\n  getSearchOptions(labelKeys) {\n    // labelKeys: array of strings\n    // return an array of objects as input for Select.options\n    let allLabels = []\n    for (const labelKey of labelKeys) {\n      let labels = this.getAttr(labelKey)\n      // take the unique values\n      labels = [...new Set(labels)]\n      labels = labels.map(x => {\n        return { value: x, label: x, key: labelKey }\n      })\n      labels = { label: labelKey, options: labels }\n      allLabels.push(labels)\n    }\n    return allLabels\n  }\n\n  calculateColorScale(metaKey) {\n    // Color points by a certain metaKey\n    // update colorKey\n    let metas = this.getAttr(metaKey)\n\n    const meta = _.findWhere(this.metas, { name: metaKey })\n    const dtype = meta.type\n\n    if (dtype !== 'float' && dtype !== 'int' && meta.nUnique > 20) {\n      metas = utils.encodeRareCategories(metas, 19)\n    }\n    let uniqueCats = new Set(metas)\n    const nUniqueCats = uniqueCats.size\n    uniqueCats = Array.from(uniqueCats)\n    // Make unknown to be gray\n    if (uniqueCats.indexOf('unknown') !== -1) {\n      if (uniqueCats.length > 7) {\n        const idx = uniqueCats.indexOf('unknown')\n        let greyIdx = 7\n        if (uniqueCats.length === 20) {\n          greyIdx = 15\n        }\n        const elem = uniqueCats[greyIdx]\n        uniqueCats[greyIdx] = 'unknown'\n        uniqueCats[idx] = elem\n      }\n    }\n    // Make RARE to be grey\n    if (uniqueCats.indexOf(utils.RARE) !== -1) {\n      if (uniqueCats.length === 20) {\n        const idx = uniqueCats.indexOf(utils.RARE)\n        let greyIdx2 = 15\n        if (uniqueCats.indexOf('unknown') !== -1) {\n          greyIdx2 = 14\n        }\n        const elem = uniqueCats[greyIdx2]\n        uniqueCats[greyIdx2] = utils.RARE\n        uniqueCats[idx] = elem\n      }\n    }\n\n    // make colorScale\n    let colorExtent = d3.extent(metas)\n    const minScore = colorExtent[0]\n    const maxScore = colorExtent[1]\n    let colorScale = d3Scale\n      .scalePow()\n      .domain([minScore, (minScore + maxScore) / 2, maxScore])\n      .range(['#1f77b4', '#ddd', '#d62728'])\n\n    if (dtype === 'boolean') {\n      colorScale = d3Scale\n        .scaleOrdinal()\n        .domain([true, false])\n        .range(['#cc0000', '#cccccc'])\n    } else if (nUniqueCats < 11) {\n      colorScale = d3Scale.scaleOrdinal(d3.schemeCategory10).domain(uniqueCats)\n    } else if (nUniqueCats > 10 && nUniqueCats <= 20) {\n      colorScale = d3Scale.scaleOrdinal(d3.schemeCategory10).domain(uniqueCats)\n    } else if (nUniqueCats <= 40) {\n      const colors40 = [\n        '#1b70fc',\n        '#faff16',\n        '#d50527',\n        '#158940',\n        '#f898fd',\n        '#24c9d7',\n        '#cb9b64',\n        '#866888',\n        '#22e67a',\n        '#e509ae',\n        '#9dabfa',\n        '#437e8a',\n        '#b21bff',\n        '#ff7b91',\n        '#94aa05',\n        '#ac5906',\n        '#82a68d',\n        '#fe6616',\n        '#7a7352',\n        '#f9bc0f',\n        '#b65d66',\n        '#07a2e6',\n        '#c091ae',\n        '#8a91a7',\n        '#88fc07',\n        '#ea42fe',\n        '#9e8010',\n        '#10b437',\n        '#c281fe',\n        '#f92b75',\n        '#07c99d',\n        '#a946aa',\n        '#bfd544',\n        '#16977e',\n        '#ff6ac8',\n        '#a88178',\n        '#5776a9',\n        '#678007',\n        '#fa9316',\n        '#85c070',\n        '#6aa2a9',\n        '#989e5d',\n        '#fe9169',\n        '#cd714a',\n        '#6ed014',\n        '#c5639c',\n        '#c23271',\n        '#698ffc',\n        '#678275',\n        '#c5a121',\n        '#a978ba',\n        '#ee534e',\n        '#d24506',\n        '#59c3fa',\n        '#ca7b0a',\n        '#6f7385',\n        '#9a634a',\n        '#48aa6f',\n        '#ad9ad0',\n        '#d7908c',\n        '#6a8a53',\n        '#8c46fc',\n        '#8f5ab8',\n        '#fd1105',\n        '#7ea7cf',\n        '#d77cd1',\n        '#a9804b',\n        '#0688b4',\n        '#6a9f3e',\n        '#ee8fba',\n        '#a67389',\n        '#9e8cfe',\n        '#bd443c',\n        '#6d63ff',\n        '#d110d5',\n        '#798cc3',\n        '#df5f83',\n        '#b1b853',\n        '#bb59d8',\n        '#1d960c',\n        '#867ba8',\n        '#18acc9',\n        '#25b3a7',\n        '#f3db1d',\n        '#938c6d',\n        '#936a24',\n        '#a964fb',\n        '#92e460',\n        '#a05787',\n        '#9c87a0',\n        '#20c773',\n        '#8b696d',\n        '#78762d',\n        '#e154c6',\n        '#40835f',\n        '#d73656',\n        '#1afd5c',\n        '#c4f546',\n        '#3d88d8',\n        '#bd3896',\n        '#1397a3',\n        '#f940a5',\n        '#66aeff',\n        '#d097e7',\n        '#fe6ef9',\n        '#d86507',\n        '#8b900a',\n        '#d47270',\n        '#e8ac48',\n        '#cf7c97',\n        '#cebb11',\n        '#718a90',\n        '#e78139',\n        '#ff7463',\n        '#bea1fd'\n      ]\n      colorScale = d3Scale\n        .scaleOrdinal()\n        .range(colors40)\n        .domain(uniqueCats)\n    }\n\n    return colorScale\n  }\n\n  calculateShapeScale(metaKey) {\n    let symbols = d3.symbols.map(t => d3.symbol().type(t)())\n\n    // make shapeScale for d3.legend\n    const meta = _.findWhere(this.metas, { name: metaKey })\n\n    // categorical data\n    // get grouped datasets, each group is going to be a cloud\n    let scatterDataSubsets = this.groupBy(metaKey)\n    let shapeLabels\n    let shapeScale = d3Scale\n      .scaleOrdinal()\n      .domain(Object.keys(scatterDataSubsets))\n      .range(symbols)\n\n    if (['int', 'float'].indexOf(meta.type) !== -1 && meta.nUnique > 6) {\n      // get grouped datasets, each group is going to be a cloud\n      scatterDataSubsets = this.binBy(metaKey, 6)\n      // Make a threshold scale\n      let binnedValues = utils.binValues(_.pluck(this.data, metaKey), 6)\n\n      if (meta.name === 'p-value') {\n        // get grouped datasets, each group is going to be a cloud\n        const pValueDomain = [0.001, 0.01, 0.05, 0.1, 1]\n        scatterDataSubsets = this.binBy2(metaKey, pValueDomain)\n        // Make a threshold scale\n        binnedValues = utils.binValues2(\n          _.pluck(this.data, metaKey),\n          pValueDomain\n        )\n        // overwrite the symbols map to make it having the same length with pValueDomain\n        symbols = _.map(\n          d3.symbols.slice(0, pValueDomain.length),\n          function (t) {\n            return d3.symbol().type(t)()\n          }\n        )\n      }\n\n      shapeScale = d3Scale\n        .scaleThreshold()\n        .domain(binnedValues.domain)\n        .range(symbols)\n      shapeLabels = binnedValues.labels\n    }\n    return {\n      shapeScale: shapeScale,\n      shapeLabels: shapeLabels,\n      scatterDataSubsets: scatterDataSubsets\n    }\n  }\n}\n","import React from 'react'\nimport * as THREE from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils.js'\nimport _ from 'underscore'\nimport { Texture, symbolTypes } from './texture'\nimport * as utils from './utils'\nimport { ScatterData, ScatterDataSubset } from './ScatterData.js'\nimport PropTypes from 'prop-types'\n\nclass PointsGeometry {\n  constructor(args) {\n    this.model = args.model\n    this.geometry = null\n\n    this.createGeometry()\n  }\n\n  createGeometry() {\n    const geometry = new THREE.BufferGeometry()\n\n    const model = this.model\n\n    geometry.setIndex(new THREE.BufferAttribute(model.indices, 1))\n    geometry.setAttribute(\n      'position',\n      new THREE.BufferAttribute(model.positions, 3)\n    )\n    // this is used for tracking the original orders of the data objects in the entire ScatterData\n    geometry.userData = { index: model.getAttr('index') }\n\n    geometry.computeBoundingSphere()\n\n    this.geometry = geometry\n  }\n}\n\n/**\n * The 3d canvas view underyling the scatterBoard\n */\nexport class Scatter3dView extends React.Component {\n  constructor(props) {\n    super(props)\n    const is3d = this.props.is3d\n    this.state = {\n      isLoading: false,\n      isLoaded: false,\n      url: this.props.url,\n      data: this.props.data,\n      model: null,\n      labelKeys: this.props.labelKeys, // which metaKey to use as labels\n      colorKey: this.props.colorKey, // which metaKey to use as colors\n      shapeKey: this.props.shapeKey,\n      pointSize: is3d ? 0.5 : 12, // the size of the points\n      is3d: is3d, // 3d or 2d\n      colorScale: this.props.colorScale,\n      shapeScale: this.props.shapeScale,\n      shapeLabels: this.props.shapeLabels\n    }\n    // events\n    this.onMouseMove = this.onMouseMove.bind(this)\n    this.onMouseDown = this.onMouseDown.bind(this)\n    this.onMouseUp = this.onMouseUp.bind(this)\n    this.onClick = this.onClick.bind(this)\n  }\n\n  componentDidMount() {\n    // fetch data from url\n    if (this.props.url) {\n      // url is given\n      this.setState({ isLoading: true })\n      fetch(this.props.url)\n        .then(response => {\n          if (response.ok) {\n            return response.json()\n          } else {\n            throw new Error('Something went wrong when fetching data ...')\n          }\n        })\n        .then(data => {\n          this.setState({\n            data: data,\n            model: new ScatterData(data), // init model\n            isLoading: false,\n            isLoaded: true\n          })\n          this.makeMaterial()\n          this.setUpStage()\n          this.shapeBy(this.state.shapeKey)\n        })\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (!this.props.url) {\n      // only trigger rendering when url is not set directly to prop\n      // data is set via parent compoent\n      if (\n        prevState.data === null &&\n        prevProps.data === null &&\n        this.props.data !== null &&\n        this.state.data === null\n      ) {\n        this.makeMaterial()\n        this.setUpStage()\n      } else if (this.props.data !== null && this.props.shapeScale !== null) {\n        this.shapeBy(this.props.shapeKey) // will update state shapeScale etc.\n        this.startAnimate()\n      } else if (this.props.colorKey !== prevProps.colorKey) {\n        // colorKey changed through parent state passed as prop\n      }\n    }\n  }\n  componentWillUnmount() {\n    if (this.animateId) {\n      this.stopAnimate()\n    }\n  }\n\n  render() {\n    return (\n      <div\n        ref={ref => (this.mount = ref)}\n        style={this.props.style}\n        onMouseDown={this.onMouseDown}\n        onMouseMove={this.onMouseMove}\n        onMouseUp={this.onMouseUp}\n        onClick={this.onClick}\n      />\n    )\n  }\n\n  setUpStage() {\n    // set up THREE.js visualization components\n    const { width, height } = this.size()\n    const aspectRatio = width / height\n\n    // set up scene, camera, renderer\n    const scene = new THREE.Scene()\n    // set the id for this object\n    this.id = scene.uuid\n\n    const renderer = new THREE.WebGLRenderer()\n    renderer.setClearColor(0xffffff)\n\n    // 2d\n    const scale = 4\n    const ORTHO_CAMERA_FRUSTUM_HALF_EXTENT = 10.5 / (scale*2)\n    let left = -ORTHO_CAMERA_FRUSTUM_HALF_EXTENT * scale\n    let right = ORTHO_CAMERA_FRUSTUM_HALF_EXTENT * scale\n    let bottom = -ORTHO_CAMERA_FRUSTUM_HALF_EXTENT\n    let top = ORTHO_CAMERA_FRUSTUM_HALF_EXTENT * (scale*2)\n    // Scale up the larger of (w, h) to match the aspect ratio.\n    if (aspectRatio > 1) {\n      left *= aspectRatio\n      right *= aspectRatio\n    } else {\n      top /= aspectRatio\n      bottom /= aspectRatio\n    }\n    let camera = new THREE.OrthographicCamera(\n      left,\n      right,\n      top,\n      bottom,\n      -1000,\n      1000\n    )\n    if (this.state.is3d) {\n      camera = new THREE.PerspectiveCamera(70, aspectRatio, 0.01, 1000000)\n      camera.position.z = 30\n    }\n\n    // Put the renderer's DOM into the container\n    renderer.domElement.id = 'renderer-' + this.id\n    renderer.domElement.style.display = 'block'\n    renderer.domElement.style.width = '100%'\n    renderer.domElement.style.height = '100%'\n    this.mount.appendChild(renderer.domElement)\n\n    // set up orbit controls\n    const controls = new OrbitControls(camera, renderer.domElement)\n\n    controls.enableZoom = true\n    controls.enableDamping = true\n    controls.dampingFactor = 0.25\n    controls.screenSpacePanning = true\n\n    if (!this.state.is3d) {\n      controls.enableRotate = false\n      controls.mouseButtons = {\n        LEFT: THREE.MOUSE.RIGHT,\n        MIDDLE: THREE.MOUSE.DOLLY,\n        RIGHT: THREE.MOUSE.LEFT\n      }\n    } else {\n      controls.autoRotate = true\n      controls.autoRotateSpeed = 2.0\n    }\n\n    controls.addEventListener('start', function () {\n      controls.autoRotate = false\n    })\n\n    const mouse = new THREE.Vector2()\n\n    // bind three js objects to component\n    this.scene = scene\n    this.renderer = renderer\n    this.camera = camera\n    this.controls = controls\n    this.mouse = mouse\n    this.updated = true\n  }\n\n  onMouseDown(e) {\n    this.mouseMoved = false\n  }\n\n  onMouseMove(e) {\n    const { width, height } = this.size()\n    if (e.nativeEvent !== undefined) {\n      Object.assign(this.mouse, {\n        x: (e.nativeEvent.offsetX / width) * 2 - 1,\n        y: -(e.nativeEvent.offsetY / height) * 2 + 1,\n      })\n    }\n    this.updated = true\n    this.mouseMoved = true\n  }\n\n  onMouseUp(e) {\n    if (this.mouseMoved === true) return\n    this.onClick(e)\n  }\n\n  onClick(e) {\n    if (typeof this.props.onClick === 'function') {\n      const trueIdx = this.points.geometry.userData.index[this.getPoint()]\n      const datum = this.props.model.data[trueIdx]\n      this.props.onClick(e, datum)\n    }\n  }\n\n  makeMaterial() {\n    const materials = []\n    for (const symbolType of symbolTypes) {\n      const textureResult = new Texture(symbolType).load()\n\n      const material = new THREE.PointsMaterial({\n        vertexColors: THREE.VertexColors,\n        size: this.state.pointSize,\n        sizeAttenuation: this.state.is3d,\n        map: textureResult,\n        alphaTest: 0.2,\n        transparent: true,\n        opacity: 0.6\n      })\n      materials.push(material)\n    }\n\n    this.materials = materials\n  }\n\n  clearScene() {\n    const scene = this.scene\n    for (const child of scene.children) {\n      scene.remove(child)\n    }\n  }\n\n  shapeBy(metaKey) {\n    const model = this.props.model\n    const scene = this.scene\n    const { scatterDataSubsets } = model.calculateShapeScale(metaKey)\n\n    // Update geometry by merging individual genmetries from each group\n    const geometries = []\n    for (const key of Object.keys(scatterDataSubsets)) {\n      const geometry = new PointsGeometry({\n        model: scatterDataSubsets[key]\n      })\n      geometries.push(geometry.geometry)\n    }\n    const mergedGeometry = BufferGeometryUtils.mergeBufferGeometries(geometries)\n    // concat all indices from each geometry\n    const arrayOfIndices = geometries.map(g => g.userData.index)\n    const indices = arrayOfIndices.reduce((arr1, arr2) => {\n      return arr1.concat(arr2)\n    })\n    let labels = model.getLabels(this.state.labelKeys)\n    labels = utils.orderArray(labels, indices)\n\n    mergedGeometry.userData = { index: indices, labels: labels }\n    const groupSizes = geometries.map(g => g.index.count)\n    // to keep track of the cumulative sums of the group sizes, prepended by -1\n    const cumsums = groupSizes.reduce(\n      (a, x, i) => [...a, x + (a[i - 1] || 0)],\n      []\n    )\n    cumsums.unshift(-1)\n\n    for (let i = 0; i < geometries.length; i++) {\n      mergedGeometry.addGroup(cumsums[i] + 1, groupSizes[i], i)\n    }\n\n    const points = new THREE.Points(mergedGeometry, this.materials)\n    // clear clouds\n    this.clearScene()\n    scene.add(points)\n    this.points = points\n\n    // set colors\n    this.setColors(this.props.colorScale, this.props.colorKey)\n  }\n\n  renderScatter() {\n    const closestPoint = this.getPoint()\n    // reset colors\n    this.resetColors()\n    // remove text-label if exists\n    const textLabel = document.getElementById('text-label-' + this.id)\n    if (textLabel) {\n      textLabel.remove()\n    }\n\n    // add interactivities if there is intesecting points\n    if (closestPoint !== undefined) {\n      // change color of the point\n      this.points.geometry.attributes.color.needsUpdate = true\n\n      this.points.geometry.attributes.color.array[closestPoint * 3] = 0.1\n      this.points.geometry.attributes.color.array[closestPoint * 3 + 1] = 0.8\n      this.points.geometry.attributes.color.array[closestPoint * 3 + 2] = 0.1\n\n      // find the position of the point\n      const pointPosition = {\n        x: this.points.geometry.attributes.position.array[closestPoint * 3],\n        y: this.points.geometry.attributes.position.array[closestPoint * 3 + 1],\n        z: this.points.geometry.attributes.position.array[closestPoint * 3 + 2]\n      }\n      // add text canvas\n      const textCanvas = this.makeTextCanvas(\n        this.points.geometry.userData.labels[closestPoint],\n        pointPosition.x,\n        pointPosition.y,\n        pointPosition.z,\n        this.points.rotation,\n        {\n          fontsize: 24,\n          fontface: 'arial, sans-serif',\n          textColor: { r: 0, g: 0, b: 0, a: 0.8 }\n        }\n      )\n\n      textCanvas.id = 'text-label-' + this.id\n      this.mount.appendChild(textCanvas)\n\n      if (typeof this.props.onMouseOver === 'function') {\n        const trueIdx = this.points.geometry.userData.index[closestPoint]\n        const datum = this.props.model.data[trueIdx]\n        this.props.onMouseOver(datum)\n      }\n    }\n  }\n\n  makeTextCanvas(message, x, y, z, euler, parameters) {\n    if (parameters === undefined) parameters = {}\n    const fontface = parameters.hasOwnProperty('fontface')\n      ? parameters['fontface']\n      : 'arial, sans-serif'\n    const fontsize = parameters.hasOwnProperty('fontsize')\n      ? parameters['fontsize']\n      : 18\n    const textColor = parameters.hasOwnProperty('textColor')\n      ? parameters['textColor']\n      : { r: 0, g: 0, b: 255, a: 0.8 }\n    const lineHeight = parameters.hasOwnProperty('lineHeight')\n      ? parameters['lineHeight']\n      : 20\n\n    const canvas = document.createElement('canvas')\n    const context = canvas.getContext('2d')\n\n    const { width, height } = this.size()\n    canvas.width = width\n    canvas.height = height\n\n    context.font = fontsize + 'px ' + fontface\n    context.textBaseline = 'alphabetic'\n\n    context.textAlign = 'left'\n\n    // text color.  Note that we have to do this AFTER the round-rect as it also uses the \"fillstyle\" of the canvas\n    context.fillStyle = utils.getCanvasColor(textColor)\n\n    // calculate the project of 3d point into 2d plain\n    const point = new THREE.Vector3(x, y, z).applyEuler(euler)\n    const pv = new THREE.Vector3().copy(point).project(this.camera)\n    const coords = {\n      x: ((pv.x + 1) / 2) * width, // * this.DPR,\n      y: -(((pv.y - 1) / 2) * height) // * this.DPR\n    }\n    // draw the text (in multiple lines)\n    const lines = message.split('\\n')\n    for (let i = 0; i < lines.length; i++) {\n      context.fillText(lines[i], coords.x, coords.y + i * lineHeight)\n    }\n\n    // styles of canvas element\n    canvas.style.left = 0\n    canvas.style.top = 0\n    canvas.style.position = 'absolute'\n    canvas.style.pointerEvents = 'none'\n\n    return canvas\n  }\n\n  resetColors() {\n    this.setColors(this.props.colorScale, this.props.colorKey)\n  }\n\n  setColors(colorScale, metaKey) {\n    // Color points by a certain metaKey given colorScale\n    const model = this.props.model\n    let metas = model.getAttr(metaKey)\n    const geometry = this.points.geometry\n    const idx = geometry.userData.index\n    metas = utils.orderArray(metas, idx)\n\n    const meta = _.findWhere(model.metas, { name: metaKey })\n    const dtype = meta.type\n    if (dtype !== 'float' && dtype !== 'int' && meta.nUnique > 20) {\n      metas = utils.encodeRareCategories(metas, 19)\n    }\n\n    // construct colors BufferAttribute\n    const colors = new Float32Array(model.n * 3)\n    let frequentCategories = { length: 2 }\n    if (colorScale.hasOwnProperty('domain')) {\n      frequentCategories = colorScale.domain().slice()\n    }\n\n    for (let i = metas.length - 1; i >= 0; i--) {\n      let color = colorScale(metas[i])\n      color = new THREE.Color(color)\n      color.toArray(colors, i * 3)\n    }\n\n    if (frequentCategories.length > 3) {\n      for (let i = metas.length - 1; i >= 0; i--) {\n        let color = colorScale(metas[i])\n        if (frequentCategories.indexOf(metas[i]) === -1) {\n          color = colorScale(utils.RARE)\n        }\n        color = new THREE.Color(color)\n        color.toArray(colors, i * 3)\n      }\n    }\n    geometry.setAttribute('color', new THREE.BufferAttribute(colors.slice(), 3))\n  }\n\n  startAnimate() {\n    if (!this.animateId) {\n      this.animate()\n    }\n  }\n\n  size() {\n    let clientWidth, clientHeight\n    if ((this.renderer || {}).domElement === undefined) {\n      if (this.mount !== undefined) {\n        clientWidth = this.mount.clientWidth\n        clientHeight = this.mount.clientHeight\n      } else {\n        clientWidth = 800\n        clientHeight = 600\n      }\n    } else {\n      clientWidth = this.renderer.domElement.clientWidth\n      clientHeight = this.renderer.domElement.clientHeight\n    }\n    return {\n      width: (clientWidth * window.devicePixelRatio)|0,\n      height: (clientHeight * window.devicePixelRatio)|0,\n    }\n  }\n\n  resizeRendererToDisplaySize() {\n    const { renderer } = this\n    const canvas = renderer.domElement\n    const { width, height } = this.size()\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height, false)\n    }\n    return needResize\n  }\n\n  animate() {\n    const { renderer, scene, camera } = this\n    if (this.resizeRendererToDisplaySize()) {\n      const canvas = renderer.domElement\n      camera.aspect = canvas.clientWidth / canvas.clientHeight\n      camera.updateProjectionMatrix()\n    }\n    this.controls.update()\n    if (this.updated) {\n      this.renderScatter()\n      this.updated = false\n    }\n    renderer.render(scene, camera)\n    this.animateId = window.requestAnimationFrame(() => this.animate())\n  }\n\n  stopAnimate() {\n    window.cancelAnimationFrame(this.animateId)\n  }\n\n  highlightQuery(metaKey, query) {\n    // To highlight a query result by adding a new PointsGeometry\n    // instance to the scene\n    this.removeHighlightedPoints()\n    // get the reordered data in geometry\n    const reorderedData = utils.orderArray(\n      this.props.model.data,\n      this.points.geometry.userData.index\n    )\n    // find the matched data points\n    const matchedData = reorderedData.filter(rec => {\n      return rec[metaKey] === query\n    })\n    const dataSubset = new ScatterDataSubset(matchedData)\n    const highlightCould = this.createHighlightCloud(dataSubset)\n    highlightCould.name = 'highlight-' + this.id\n    this.scene.add(highlightCould)\n  }\n\n  createHighlightCloud(dataSubset) {\n    // dataSubset should be a ScatterDataSubset instance\n    const geometryHighlight = new PointsGeometry({ model: dataSubset })\n    const material = new THREE.PointsMaterial({\n      size: this.state.pointSize * 5,\n      sizeAttenuation: this.state.is3d,\n      map: this.materials[0].map,\n      transparent: true,\n      opacity: 0.4,\n      color: 0xffff00\n    })\n\n    const highlightPoints = new THREE.Points(\n      geometryHighlight.geometry,\n      material\n    )\n    // update rotation\n    highlightPoints.rotation.x = this.points.rotation.x\n    highlightPoints.rotation.y = this.points.rotation.y\n    return highlightPoints\n  }\n\n  removeHighlightedPoints() {\n    const scene = this.scene\n    scene.remove(scene.getObjectByName('highlight-' + this.id))\n  }\n\n  getPoint() {\n    const { mouse, camera } = this\n\n    let closestPoint = undefined\n    let closestDist = undefined\n    let point3 = new THREE.Vector3()\n    let point2 = new THREE.Vector2()\n\n    for (const pointIndex of this.points.geometry.index.array) {\n      point3.set(\n        this.points.geometry.attributes.position.array[pointIndex * 3],\n        this.points.geometry.attributes.position.array[pointIndex * 3 + 1],\n        this.points.geometry.attributes.position.array[pointIndex * 3 + 2]\n      )\n      point3.project(camera)\n      point2.set(point3.x, point3.y)\n      const dist = point2.distanceToSquared(mouse)\n      if (dist < Math.min(1.0, 1 / (camera.zoom * camera.zoom)) && (closestDist === undefined || dist < closestDist)) {\n        closestPoint = pointIndex\n        closestDist = dist\n      }\n    }\n    return closestPoint\n  }\n}\n\nScatter3dView.propTypes = {\n  /**\n   * ([{x: 0, y: 0, z: 0, ...}]): the json formatted data \n   */\n  data: PropTypes.arrayOf(\n    PropTypes.shape({\n      x: PropTypes.number.isRequired,\n      y: PropTypes.number.isRequired,\n      z: PropTypes.number,\n    })\n  ),\n  /**\n   * ScatterData(data)\n   */\n  model: PropTypes.any,\n  /**\n   * (_string_): the key to color the dots by default.\n   */\n  colorKey: PropTypes.string,\n  /**\n   * (_string_): the key to shape the dots by default.\n   */\n  shapeKey: PropTypes.string,\n  /**\n   * (_Array_ of strings): the ordered list of keys of attributes to display for the dots when mouse hovers.\n   */\n  labelKeys: PropTypes.arrayOf(PropTypes.string),\n  /**\n   * (d3-color-scale): Color scale\n   */\n  colorScale: PropTypes.any,\n  /**\n   * (d3-color-scale): Color scale\n   */\n  shapeScale: PropTypes.any,\n  /**\n   * (d3-color-scale): Color scale\n   */\n  shapeLabels: PropTypes.any,\n  /**\n   * (_boolean_): should the scatter plot in 3-D (true) or 2-D (false).\n   */\n  is3d: PropTypes.bool,\n  /**\n   * (_function_): a callback function handling when user click a data point. The input of the function is mouse event and the datum object being clicked.\n   */\n  onClick: PropTypes.func,\n  /**\n   * (_function_): a callback function handling when user hovers over a data point. The input of the function is the datum object being clicked.\n   */\n  onMouseOver: PropTypes.func,\n\n  /// DASH\n\n  /**\n   * The ID used to identify this component in Dash callbacks.\n   */\n  id: PropTypes.string,\n  /**\n   * Dash-assigned callback that should be called to report property changes\n   * to Dash, to make them available for callbacks.\n   */\n  setProps: PropTypes.func,\n}\n","/*\nThe widgets for the interactive scatter plot.\n*/\nimport React from 'react'\nimport * as d3 from 'd3'\nimport legend from 'd3-svg-legend'\nimport Select from 'react-select'\n\nexport class Legend extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      width: this.props.width || 300,\n      height: this.props.height || 800\n    }\n  }\n\n  componentDidMount() {\n    this.setUpDOMs()\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (prevProps.colorScale !== this.props.colorScale) {\n      this.displayColorLegend(this.props.colorScale, this.props.colorKey)\n    }\n    if (prevProps.shapeScale !== this.props.shapeScale) {\n      this.displayShapeLegend(\n        this.props.shapeScale,\n        this.props.shapeKey,\n        this.props.shapeLabels\n      )\n    }\n  }\n\n  render() {\n    return (\n      <div\n        ref={ref => (this.mount = ref)}\n        // onMouseMove={e => this.handleMouseMove(e)}\n      />\n    )\n  }\n\n  setUpDOMs() {\n    // set up DOMs for the legends\n    const { width, height } = this.state\n    this.el = d3\n      .select(this.mount)\n      .append('svg')\n      .attr('id', 'legend')\n      .attr('width', width)\n      .attr('height', height)\n\n    this.g = this.el\n      .append('g')\n      .attr('class', 'legend')\n      .attr('transform', 'translate(10, 20)')\n    this.g\n      .append('g')\n      .attr('id', 'legendShape')\n      .attr('class', 'legendPanel')\n      .attr('transform', 'translate(0, 0)')\n    this.g\n      .append('g')\n      .attr('id', 'legendColor')\n      .attr('class', 'legendPanel')\n      .attr('transform', 'translate(110, 0)')\n\n    // styles\n    this.mount.style.position = 'absolute'\n    this.mount.style.zIndex = 10\n    this.mount.style.overflow = 'visible'\n    this.mount.style.left = 0\n    this.mount.style.top = 0\n    this.mount.style.pointerEvents = 'none'\n  }\n\n  displayShapeLegend(shapeScale, shapeKey, shapeLabels) {\n    const legendShape = legend\n      .legendSymbol()\n      .scale(shapeScale)\n      .orient('vertical')\n      .title(shapeKey)\n    if (shapeLabels) {\n      legendShape.labels(shapeLabels)\n    }\n    this.g.select('#legendShape').call(legendShape)\n  }\n\n  displayColorLegend(colorScale, colorKey) {\n    const legendColor = legend\n      .legendColor()\n      .title(colorKey)\n      .shapeWidth(20)\n      .cells(5)\n      .labelFormat(d3.format('.2f'))\n      .scale(colorScale)\n\n    this.g.select('#legendColor').call(legendColor)\n  }\n}\n\nexport class SelectDropdown extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      label: this.props.label,\n      options: null,\n      defaultValue: this.props.defaultValue\n    }\n    this.handleChange = this.handleChange.bind(this)\n  }\n\n  render() {\n    return (\n      <div ref={ref => (this.mount = ref)}>\n        <label>{this.props.label}</label>\n        <Select\n          defaultValue={this.state.defaultValue}\n          options={this.props.options}\n          onChange={this.handleChange}\n          styles={{\n            container: () => ({\n              width: this.props.width\n            })\n          }}\n        />\n      </div>\n    )\n  }\n\n  handleChange(value) {\n    this.props.onSelectChange(value)\n  }\n}\n\nexport class SearchSelectize extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      searchStr: '',\n      searched: false\n    }\n    this.handleChange = this.handleChange.bind(this)\n    this.handleClear = this.handleClear.bind(this)\n  }\n\n  render() {\n    const searched = this.state.searched\n    return (\n      <div ref={ref => (this.mount = ref)}>\n        <label>{this.props.label}</label>\n        <Select\n          defaultValue=''\n          defaultInputValue=''\n          placeholder='Type to search...'\n          options={this.props.options}\n          onChange={this.handleChange}\n          styles={{\n            container: () => ({\n              width: this.props.width\n            })\n          }}\n        />\n        {searched && (\n          <button\n            onClick={this.handleClear}\n            className='btn btn-sm btn-outline-secondary'\n            style={{ marginTop: 5 }}\n          >\n            Clear highlighted points\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  handleChange(value) {\n    this.setState({ searched: true })\n    this.props.onInputChange(value)\n  }\n\n  handleClear() {\n    this.setState({ searched: false })\n    this.props.onClearBtnClicked()\n  }\n}\n","import React from 'react'\nimport { Scatter3dView } from './ScatterPlot.jsx'\nimport { ScatterData } from './ScatterData.js'\nimport * as scatterWidgets from './ScatterWidgets.jsx'\nimport PropTypes from 'prop-types'\n\n/**\n * A React implementation of THREE.js 2d/3d scatter plot.\n */\nexport class ScatterBoard extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      data: null,\n      model: null,\n      colorScale: null,\n      shapeScale: null,\n      shapeLabels: null,\n      colorKey: this.props.colorKey,\n      shapeKey: this.props.shapeKey,\n      labelKeys: this.props.labelKeys,\n      searchKeys: this.props.searchKeys,\n      is3d: this.props.is3d\n    }\n    // events\n    this.handleColorKeyChange = this.handleColorKeyChange.bind(this)\n    this.handleShapeKeyChange = this.handleShapeKeyChange.bind(this)\n    this.handleSearchInputChange = this.handleSearchInputChange.bind(this)\n    this.handleClearBtnClick = this.handleClearBtnClick.bind(this)\n  }\n\n  componentDidMount() {\n    if (this.props.data !== undefined) {\n      this.setState({\n        data: this.props.data,\n        model: new ScatterData(this.props.data),\n      })\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.data !== this.props.data) {\n      if (this.props.data === undefined) {\n        this.setState({\n          data: null,\n          model: null,\n        })\n      } else {\n        this.setState({\n          data: this.props.data,\n          model: new ScatterData(this.props.data),\n        })\n      }\n    }\n    if (prevState.data === null && prevState.data !== this.state.data) {\n      // data has been fetched for the first time\n      const { colorKey, shapeKey } = this.state\n      const model = this.state.model\n\n      const colorScale = model.calculateColorScale(colorKey)\n      const { shapeScale, shapeLabels } = model.calculateShapeScale(shapeKey)\n      this.setState({\n        colorScale: colorScale,\n        shapeScale: shapeScale,\n        shapeLabels: shapeLabels\n      })\n    }\n  }\n\n  render() {\n    // variables to be passed to children's states\n    const { colorKey, shapeKey, labelKeys, searchKeys, is3d } = this.state\n    const { colorScale, shapeScale, shapeLabels } = this.state\n    let colorOptions = null\n    let shapeOptions = null\n    let searchOptions = null\n    if (this.state.model) {\n      colorOptions = this.state.model.getColorOptions()\n      shapeOptions = this.state.model.getShapeOptions()\n      if (searchKeys) {\n        searchOptions = this.state.model.getSearchOptions(searchKeys)\n      }\n    }\n    return (\n      <div style={this.props.style}>\n        <Scatter3dView\n          style={{ display: 'block', width: '100%', height: '100%' }}\n          data={this.state.data}\n          model={this.state.model}\n          colorKey={colorKey}\n          shapeKey={shapeKey}\n          labelKeys={labelKeys}\n          colorScale={colorScale}\n          shapeScale={shapeScale}\n          shapeLabels={shapeScale}\n          is3d={is3d}\n          onClick={this.props.onClick}\n          onMouseOver={this.props.onMouseOver}\n          // create a ref for the parent to refer to the child\n          ref={scatter3dView => {\n            this.scatter3dView = scatter3dView\n          }}\n        />\n        <scatterWidgets.Legend\n          colorScale={colorScale}\n          colorKey={colorKey}\n          shapeScale={shapeScale}\n          shapeKey={shapeKey}\n          shapeLabels={shapeLabels}\n        />\n        <div\n          style={{\n            zIndex: 10,\n            top: 0,\n            right: 0,\n            width: 200,\n            position: 'absolute'\n          }}\n        >\n          {colorOptions && colorOptions.length > 1 && (\n            <scatterWidgets.SelectDropdown\n              label='Color by:'\n              defaultValue={{\n                value: colorKey,\n                label: colorKey\n              }}\n              options={colorOptions}\n              onSelectChange={this.handleColorKeyChange}\n              width={180}\n            />\n          )}\n          {shapeOptions && shapeOptions.length > 1 && (\n            <scatterWidgets.SelectDropdown\n              label='Shape by:'\n              defaultValue={{\n                value: shapeKey,\n                label: shapeKey\n              }}\n              options={shapeOptions}\n              onSelectChange={this.handleShapeKeyChange}\n              width={180}\n            />\n          )}\n          {searchKeys && searchKeys.length > 1 && (\n            <scatterWidgets.SearchSelectize\n              label='Search:'\n              options={searchOptions}\n              onInputChange={this.handleSearchInputChange}\n              onClearBtnClicked={this.handleClearBtnClick}\n              width={180}\n            />\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  handleColorKeyChange(value) {\n    // re-coloring the map when colorKey changed\n    const colorKey = value.value\n    if (colorKey !== this.state.colorKey) {\n      const model = this.state.model\n      const colorScale = model.calculateColorScale(colorKey)\n      this.setState({ colorKey: colorKey, colorScale: colorScale })\n    }\n  }\n\n  handleShapeKeyChange(value) {\n    // re-shaping of the map when shapeKey changed\n    const shapeKey = value.value\n    if (shapeKey !== this.state.shapeKey) {\n      const model = this.state.model\n      const { shapeScale, shapeLabels } = model.calculateShapeScale(shapeKey)\n      this.setState({\n        shapeKey: shapeKey,\n        shapeScale: shapeScale,\n        shapeLabels: shapeLabels\n      })\n    }\n  }\n\n  handleSearchInputChange(valueObj) {\n    // update highlights for new search\n    const { key, value } = valueObj\n    this.scatter3dView.highlightQuery(key, value)\n  }\n\n  handleClearBtnClick() {\n    this.scatter3dView.removeHighlightedPoints()\n  }\n}\n\nScatterBoard.propTypes = {\n  /**\n   * ([{x: 0, y: 0, z: 0, ...}]): the json formatted data \n   */\n  data: PropTypes.arrayOf(\n    PropTypes.shape({\n      x: PropTypes.number.isRequired,\n      y: PropTypes.number.isRequired,\n      z: PropTypes.number,\n    })\n  ),\n  /**\n   * (_string_): the key to shape the dots by default.\n   */\n  shapeKey: PropTypes.string,\n  /**\n   * (_string_): the key to color the dots by default.\n   */\n  colorKey: PropTypes.string,\n  /**\n   * (_Array_ of strings): the ordered list of keys of attributes to display for the dots when mouse hovers.\n   */\n  labelKeys: PropTypes.arrayOf(PropTypes.string),\n  /**\n   * (_Array_ of strings): the list of keys of attributes to enable the search functionality to query against. If not provided, the SearchSelectize component will not be rendered.\n   */\n  searchKeys: PropTypes.arrayOf(PropTypes.string),\n  /**\n   * (_object_): the style to be passed to the container div\n   */\n  style: PropTypes.object,\n  /**\n   * (_boolean_): should the scatter plot in 3-D (true) or 2-D (false).\n   */\n  is3d: PropTypes.bool,\n  /**\n   * (_function_): a callback function handling when user click a data point. The input of the function is mouse event and the datum object being clicked.\n   */\n  onClick: PropTypes.func,\n  /**\n   * (_function_): a callback function handling when user hovers over a data point. The input of the function is the datum object being clicked.\n   */\n  onMouseOver: PropTypes.func,\n\n  /// DASH\n\n  /**\n   * The ID used to identify this component in Dash callbacks.\n   */\n  id: PropTypes.string,\n  /**\n   * Dash-assigned callback that should be called to report property changes\n   * to Dash, to make them available for callbacks.\n   */\n  setProps: PropTypes.func,\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\n/**\n * Lazy react component helper for constructing objects with async render functions\n */\nexport class Lazy extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      children: null\n    }\n  }\n\n  componentDidMount() {\n    if (typeof this.props.children !== 'function') {\n      throw new Error('Lazy component expects an asynchronous function body')\n    }\n    this.props.children().then(\n      (children) => this.setState(\n        () => ({ children })\n      )\n    )\n  }\n\n  render() {\n    if (this.state.children !== null) {\n      return this.state.children\n    } else if (this.props.loading === undefined) {\n      return null\n    } else if (typeof this.props.loading === 'function') {\n      return this.props.loading()\n    } else { // assuming this is valid rendered react DOM tree\n      return this.props.loading\n    }\n  }\n}\n\nLazy.propTypes = {\n  /**\n   * A function returning a promise that resolves to a react element\n   */\n  children: PropTypes.func,\n  /**\n   * Loading indicator (node or react component)\n   */\n  loading: PropTypes.oneOfType([\n    PropTypes.element, PropTypes.elementType\n  ]),\n}\n","function get_dtype(v) {\n  if ((v|0) == v) {\n    return 'int'\n  } else if ((v * 1.0) == v) {\n    return 'float'\n  } else if (v==='up' || v ==='down') {\n    return 'direction'\n  } else {\n    return 'string'\n  }\n}\n\nexport async function read_tsv(url) {\n  const response = await fetch(url)\n  const text = await response.text()\n  const rows = text.split('\\n')\n    .filter(line => line.replace(/^\\s+|\\s+$/g, '') !== '')\n    .map(line => line.split('\\t'))\n  const header = rows.shift()\n  if (rows.length === 0) return { header, data: [], dtype: {} }\n  const row_0 = rows[0]\n  const dtype = {}\n  for(let i = 0; i< row_0.length; i++) {\n    dtype[header[i]] = get_dtype(row_0[i])\n  }\n  const data = rows.map((row) => {\n    const rowdict = {}\n    for (let i = 0; i < row.length; i++) {\n      if (dtype[header[i]] === 'int') {\n        rowdict[header[i]] = row[i]|0\n      } else if (dtype[header[i]] === 'float') {\n        rowdict[header[i]] = row[i]*1.0\n      } else {\n        rowdict[header[i]] = row[i]\n      }\n    }\n    return rowdict\n  })\n  return { header, data, dtype }\n}\n","import React, { useState, useEffect } from 'react'\nimport { ScatterBoard } from './react_scatter_board'\nimport { read_tsv } from './utils'\nimport { AgGridColumn, AgGridReact } from 'ag-grid-react';\n\nimport 'ag-grid-community';\nimport 'ag-grid-community/dist/styles/ag-grid.css';\nimport 'ag-grid-community/dist/styles/ag-theme-material.css';\n\nfunction DirectionRenderer({ value }) {\n  if (value === 'up') {\n    return '<b style=\"font-size:200%;\">&uarr;</b style=\"font-size:200%;\">'\n  } else {\n    return '<b style=\"font-size:200%;\">&darr;</b style=\"font-size:200%;\">'\n  }\n}\n\nfunction App() {\n  const [plotData, setPlotData] = useState(undefined)\n  const [tableData, setTableData] = useState(undefined)\n  const [selectedCluster, setSelectedCluster] = useState(undefined)\n  const [gridApi, setGridApi] = useState(undefined)\n  const [gridColumnApi, setGridColumnApi] = useState(undefined)\n\n  function onGridReady(params) {\n    setGridApi(params.api)\n    setGridColumnApi(params.columnApi)\n    params.columnApi.autoSizeAllColumns()\n    params.api.setFilterModel({\n      adjusted_pvalue: {\n        filterType: 'number',\n        type: 'lessThan',\n        filter: 0.05,\n      }\n    })\n    params.columnApi.applyColumnState({\n      state: [\n        { colId: 'rank', sort: 'asc' },\n        { colId: 'adjusted_pvalue', sort: 'asc' },\n      ],\n      defaultState: { sort: null },\n    })\n  }\n\n  useEffect(() => {\n    ;(async () => {\n      const { data } = await read_tsv('LM2_Deidentified_UMAP.tsv')\n      const _data = []\n      for (const row of data) {\n        const [pid, type, cluster, visit] = row.sid.split('-')\n        _data.push({\n          x: row['UMAP-1']*1.0,\n          y: row['UMAP-2']*1.0,\n          sid: row.sid,\n          pid: pid.slice(1),\n          type,\n          cluster: cluster.slice(1),\n          visit: visit.slice(1),\n        })\n      }\n      setPlotData(_data)\n    })()\n\n    ;(async () => {\n      setTableData(await read_tsv('LM2_Cluster_Enrich.tsv'))\n    })()\n  }, [])\n\n  return (\n    <div className=\"App\">\n      <div className=\"header\">\n        <h2 style={{ textAlign: 'justify', textDecoration: 'underline' }}>Interactive supplement for:</h2>\n        <h1 style={{ textAlign: 'justify' }}>Predicting Lyme Disease from Patients’ Peripheral Blood Mononuclear Cells Profiled with RNA-sequencing</h1>\n        <span style={{ fontSize: '90%' }}><b>Daniel J.B. Clarke<sup>1,+</sup>, Alison W. Rebman<sup>2,+</sup>, Allison Bailey<sup>1</sup>, Megan L. Wojciechowicz<sup>1</sup>, Sherry L. Jenkins<sup>1</sup>, John E. Evangelista<sup>1</sup>, Matteo Danieletto<sup>3</sup>, Jinshui Fan<sup>2</sup>, Mark Eshoo<sup>4</sup>, Michael Mosel<sup>5</sup>, William Robinson<sup>6</sup>, Nitya Ramadoss<sup>6</sup>, Jason Bobe<sup>3</sup>, Mark J. Soloski<sup>2,*</sup>, John N. Aucott<sup>2,*</sup>, Avi Ma’ayan<sup>1,*</sup></b></span>\n        <p style={{ fontSize: '60%' }}>\n        <sup>1</sup> Department of Pharmacological Sciences; Mount Sinai Center for Bioinformatics; Icahn School of Medicine at Mount Sinai, One Gustave L. Levy Place, Box 1603, New York, NY 10029, USA< br/>\n        <sup>2</sup> Lyme Disease Research Center, Division of Rheumatology, Department of Medicine, Johns Hopkins University School of Medicine, Baltimore, MD, United States< br/>\n        <sup>3</sup> Department of Genetics and Genomic Sciences; Icahn School of Medicine at Mount Sinai, One Gustave L. Levy Place, Box 1498, New York, NY 10029, USA< br/>\n        <sup>4</sup> BlueArc Biosciences, San Diego< br/>\n        <sup>5</sup> Janus-I Science Inc. Vista, California< br/>\n        <sup>6</sup> Department of Medicine, Division of Immunology and Rheumatology, Stanford University School of Medicine< br/>\n        <sup>+</sup> Contributed equally< br/>\n        </p>\n        <p className=\"description\">\n          This interactive viewer enables you to explore the <a href=\"https://www.lymemind.org/\">LymeMIND2</a> patient cohort in gene expression space. Each point on the map corresponds to a participant where the position of each participant was computed based on a UMAP projection of their PMBC mRNA RNA-seq expression vector. Enrichment analysis is applied to explore enriched terms for each cluster. You can explore these enriched terms by clicking on a cluster to review the table below. These enrichment results were computed by performing differential expression between clusters and using the most significantly up and down regulated genes to query with <a href=\"http://maayanlab.cloud/Enrichr/\">Enrichr</a>. The <a href=\"https://maayanlab.github.io/react-scatter-board/\">react scatter board widget</a> is used to render this plot.\n        </p>\n      </div>\n      <div className=\"canvas\">\n        {plotData === undefined ? (\n          <div>Loading...</div>\n        ) : (\n          <ScatterBoard\n            style={{ position: 'relative', width: '100%', height: '100%' }}\n            data={plotData}\n            shapeKey=\"type\"\n            colorKey=\"cluster\"\n            labelKeys={['pid', 'type', 'cluster', 'visit']}\n            is3d={false}\n            onClick={(evt, datum) => {\n              if (datum === undefined) return\n              setSelectedCluster(datum.cluster)\n              gridApi.setFilterModel({\n                ...(gridApi.getFilterModel() || {}),\n                cluster: {\n                  filterType: 'text',\n                  type: 'equals',\n                  filter: datum.cluster,\n                },\n              })\n            }}\n          />\n          )}\n      </div>\n      <div className=\"table ag-theme-material\">\n        <h2 style={{ margin: 0 }}>Enriched terms for {selectedCluster === undefined ? 'all clusters' : `cluster ${selectedCluster}`}</h2>\n        {tableData === undefined ? (\n          <div>Loading...</div>\n        ) : (\n          <AgGridReact\n            onGridReady={onGridReady}\n            rowData={tableData.data}>\n            {['rank', 'direction', 'library', 'term', 'adjusted_pvalue', 'category', 'cluster']\n              .map((h, ind) =>\n              <AgGridColumn\n                key={h}\n                colId={h}\n                field={h}\n                sortable\n                cellStyle={{\n                  'string': {textAlign: 'left'}\n                }[tableData.dtype[h]]}\n                filter={{\n                  'int': 'agNumberColumnFilter',\n                  'float': 'agNumberColumnFilter',\n                  'string': 'agTextColumnFilter',\n                }[tableData.dtype[h]]}\n                type={{\n                  'int': 'numericColumn',\n                  'float': 'numericColumn',\n                  'string': 'stringColumn'\n                }[tableData.dtype[h]]}\n                resizable\n                valueFormatter={{\n                  'int': undefined,\n                  'float': ({ value }) => value.toPrecision(3),\n                }[tableData.dtype[h]]}\n                cellRenderer={{\n                  'direction': DirectionRenderer,\n                }[tableData.dtype[h]]}\n                comparator={(valueA, valueB) => {\n                  if (tableData.dtype[h] === 'int') {\n                    return valueA - valueB\n                  } else if (tableData.dtype[h] === 'float') {\n                    return valueA - valueB\n                  } else {\n                    if (valueA > valueB) return 1\n                    else if (valueA < valueB) return -1\n                    else return 0\n                  }\n                }}\n              />\n            )}\n          </AgGridReact>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}